---
# tasks file for sysinit
- name: Make sure br_netfilter module is loaded
  modprobe:
    name: br_netfilter
    state: present

- name: Setup netfilter
  copy:
    content: br_netfilter
    dest: /etc/modules-load.d/k8s.conf
    force: true

- name: Setup kernel param
  copy:
    content: |
      net.bridge.bridge-nf-call-ip6tables = 1
      net.bridge.bridge-nf-call-iptables = 1  
    dest: /etc/sysctl.d/k8s.conf
    force: true

- name: Run sysctl
  shell: sysctl --system

- name: Disable SELINUX
  selinux:
    state: disabled

- name: Disable firewall
  service:
    name: firewalld
    state: stopped
    enabled: no

- name: Install required packages
  yum:
    name: "{{ item }}"
    state: latest
  loop: "{{ packages }}"

  #- name: Copy required pkgs to all hosts
  #  copy:
  #    src: "{{ pkg_src_dir }}"/{{ item }}
  #    dest: /tmp
  #  loop: "{{ pkgs_src }}"
  #
  #- name: Unarchive crio pkg
  #  unarchive:
  #    src: /tmp/{{ crio-pkg }}
  #    dest: /tmp
  #    remote_src: yes
  #
  #- name: Install crio
  #  shell: /tmp/cri-o/install
  #
  #- name: Copy k8s pkg to all hosts
  #  copy:
  #    src: "{{ pkg-dir }}/
